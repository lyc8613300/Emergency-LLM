<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应急智能体问答界面</title>
    <!-- 引入Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- 引入Markdown渲染库 marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 引入代码高亮库 highlight.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', '"Noto Sans"', 'sans-serif'],
                    },
                    colors: {
                        'emergency-blue': {
                            '50': '#eff6ff',
                            '100': '#dbeafe',
                            '200': '#bfdbfe',
                            '300': '#93c5fd',
                            '400': '#60a5fa',
                            '500': '#3b82f6',
                            '600': '#2563eb', // 主色
                            '700': '#1d4ed8',
                            '800': '#1e40af',
                            '900': '#1e3a8a',
                        },
                        'emergency-red': {
                            '50': '#fef2f2',
                            '100': '#fee2e2',
                            '200': '#fecaca',
                            '300': '#fca5a5',
                            '400': '#f87171',
                            '500': '#ef4444',
                            '600': '#dc2626',
                            '700': '#b91c1c',
                            '800': '#991b1b',
                            '900': '#7f1d1d',
                        },
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- 引入自定义CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-gray-100 font-sans antialiased h-full overflow-hidden"> <!-- 添加渐变背景 -->

    <div class="flex h-full max-h-screen">

        <!-- 侧边栏: 深色渐变背景 -->
        <aside class="w-72 bg-gradient-to-b from-gray-900 via-gray-900 to-gray-950 text-gray-300 flex-col hidden sm:flex shadow-2xl relative overflow-hidden">
            <!-- 装饰性背景元素 -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-emergency-blue-600 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse-slow"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-600 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse-slow" style="animation-delay: 1s;"></div>
            
            <div class="p-6 border-b border-gray-800 relative z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emergency-blue-500 to-blue-600 flex items-center justify-center shadow-lg ring-2 ring-blue-500/30">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zM7.5 11.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5S9 9.17 9 10s-.67 1.5-1.5 1.5zM12 17c-2.33 0-4.32-1.45-5.12-3.5h1.67c.69 1.19 1.97 2 3.45 2s2.75-.81 3.45-2h1.67c-.8 2.05-2.79 3.5-5.12 3.5zm4.5-5.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white tracking-tight">应急智能体</h1>
                        <span class="text-xs text-gray-500 font-medium">AI-Powered Emergency System</span>
                    </div>
                </div>
            </div>

            <div class="p-4 relative z-10">
                <button class="w-full bg-gradient-to-r from-emergency-blue-600 via-blue-600 to-blue-500 text-white px-4 py-3 rounded-xl font-semibold hover:from-emergency-blue-700 hover:via-blue-700 hover:to-blue-600 transition-all duration-300 shadow-lg shadow-blue-500/50 hover:shadow-xl hover:shadow-blue-500/60 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center group">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 group-hover:rotate-90 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                    新的会话
                </button>
            </div>

            <nav id="history-list" class="flex-1 overflow-y-auto px-4 space-y-2 relative z-10 custom-scrollbar">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3 px-2">历史记录</h3>
                
                <!-- 空状态提示 -->
                <div id="empty-history" class="text-center py-8">
                    <p class="text-gray-500 text-sm">暂无历史记录</p>
                </div>
            </nav>

            <div class="p-4 border-t border-gray-800 relative z-10 bg-gray-900/50 backdrop-blur-sm">
                <div class="flex items-center space-x-3 p-2 rounded-xl hover:bg-gray-800/50 transition-all duration-200 cursor-pointer">
                    <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-blue-500 via-blue-600 to-purple-600 flex items-center justify-center font-bold text-white shadow-lg ring-2 ring-blue-500/30">
                        李
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-gray-100 truncate">李指挥</p>
                        <p class="text-xs text-gray-500 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-1.5 animate-pulse"></span>
                            在线 · ID: 800123
                        </p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 主聊天界面 -->
        <main class="flex-1 flex flex-col max-h-screen relative">

            <!-- 聊天界面头部: 毛玻璃效果 -->
            <header class="bg-white/80 backdrop-blur-xl shadow-lg shadow-gray-200/50 p-5 flex justify-between items-center z-10 border-b border-gray-200/50 relative">
                <!-- 装饰性渐变条 -->
                <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-emergency-blue-500 to-transparent"></div>
                
                <div class="flex items-center space-x-4">
                    <!-- 移动端菜单按钮 -->
                    <button id="mobile-menu-btn" class="sm:hidden p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-xl transition-all duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-emergency-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 tracking-tight">应急智能体</h2>
                        <p class="text-sm text-gray-600 flex items-center mt-0.5">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                            在线
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <a href="http://218.199.69.58:5000" target="_blank" 
                       class="px-5 py-2.5 text-base font-semibold text-white bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 rounded-xl transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg shadow-indigo-500/30"
                       title="打开模型微调平台">
                        微调平台
                    </a>
                    <button class="p-2.5 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-all duration-200 hover:scale-110 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                        </svg>
                    </button>
                    <button class="p-2.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all duration-200 hover:scale-110 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </header>

            <!-- 消息显示区域: 渐变背景 -->
            <div id="message-container" class="flex-1 overflow-y-auto p-6 md:p-8 space-y-6 bg-gradient-to-b from-gray-50 to-white custom-scrollbar">

                <!-- ========== 消息示例（已注释） ==========
                <div class="flex justify-end">
                    <div class="max-w-xl lg:max-w-2xl">
                        <div class="p-3 bg-emergency-blue-600 text-white rounded-xl shadow-md">
                            <p>
                                报告：城东化工厂发生不明气体泄露，可能是什么物质？我需要立刻知道疏散范围和SOP。
                            </p>
                        </div>
                        <p class="text-xs text-gray-500 text-right mt-1">李指挥 - 14:02</p>
                    </div>
                </div>

                <div class="flex justify-start">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emergency-blue-600 to-blue-500 text-white flex items-center justify-center font-bold text-sm flex-shrink-0 mr-3 shadow-lg">
                        AI
                    </div>
                    <div class="max-w-xl lg:max-w-2xl">
                        <div class="p-4 bg-white rounded-xl shadow-md space-y-4">

                            <p class="text-gray-800">
                                收到。正在分析城东化工厂备案物料... 匹配到高风险物质：<strong class="text-red-700">液氯 (Liquid Chlorine)</strong>。
                            </p>

                            <div class="bg-red-50 border-l-4 border-red-500 text-red-800 p-3 rounded-lg">
                                <h4 class="font-bold">!! 高度危险警告 !!</h4>
                                <p class="text-sm">液氯泄露会迅速气化，形成高浓度氯气，有毒、具腐蚀性且窒息性。必须立即采取行动。</p>
                            </div>

                            <div class="border-t pt-3">
                                <h5 class="font-semibold text-gray-900 mb-2">1. 立即疏散范围</h5>
                                <p class="text-sm text-gray-700">基于实时风向（东南风 3级）和泄露模型计算：</p>
                                <ul class="list-disc list-outside text-sm text-gray-700 pl-6 mt-2 space-y-1">
                                    <li><strong>主要危险区 (下风向):</strong> 1.5 公里</li>
                                    <li><strong>警戒区 (周边):</strong> 3.0 公里</li>
                                </ul>
                            </div>

                            <div class="border-t pt-3">
                                <h5 class="font-semibold text-gray-900 mb-2">2. 应急处置SOP (SOP-CHEM-03)</h5>
                                <ol class="list-decimal list-outside text-sm text-gray-700 pl-6 space-y-2">
                                    <li>所有人员<strong class="text-red-700">必须</strong>佩戴A级防化服和正压式空气呼吸器 (SCBA)。</li>
                                    <li>抢险组从<strong class="font-medium">上风向</strong>接近泄露点。</li>
                                    <li>使用雾状水喷淋稀释和吸收空气中的氯气，但<strong class="text-red-700">避免</strong>水流直接冲击液氯。</li>
                                    <li>立即通知下游水厂和周边企业暂停取水。</li>
                                </ol>
                            </div>

                            <div class="border-t pt-3">
                                <h5 class="font-semibold text-gray-900 mb-2">3. 实时疏散路径图 (模拟)</h5>
                                <div class="w-full h-48 bg-gray-100 rounded-xl flex items-center justify-center border border-gray-200">
                                    <p class="text-gray-500">[此处为动态生成的疏散地图]</p>
                                </div>
                                <button class="text-sm text-emergency-blue-600 hover:underline mt-2">在新窗口中打开交互地图</button>
                            </div>

                        </div>
                        <p class="text-xs text-gray-500 mt-1">智能体 - 14:03</p>
                    </div>
                </div>

                <div class="flex justify-end">
                    <div class="max-w-xl lg:max-w-2xl">
                        <div class="p-3 bg-emergency-blue-600 text-white rounded-xl shadow-md">
                            <p>
                                收到。调取附近所有消防站的A级防化服库存。
                            </p>
                        </div>
                        <p class="text-xs text-gray-500 text-right mt-1">李指挥 - 14:04</p>
                    </div>
                </div>
                ========== 消息示例结束 ========== -->

            </div>

            <!-- 输入区域 -->
            <footer class="bg-white/90 backdrop-blur-xl border-t border-gray-200/50 p-5 shadow-2xl relative">
                <!-- 装饰性渐变条 -->
                <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-emergency-blue-400 to-transparent"></div>

                <!-- 文本输入 -->
                <div class="flex items-center space-x-3">
                    <div class="flex-1 relative">
                        <textarea
                            id="message-input"
                            rows="1"
                            class="w-full p-3 pr-12 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none resize-none focus:bg-white focus:border-emergency-blue-400 transition-all duration-200 text-gray-800 placeholder-gray-400 shadow-sm focus:shadow-lg"
                            placeholder="输入您的问题或指令..."
                            oninput="autoResize(this)"
                        ></textarea>
                    </div>
                    <!-- 发送按钮 -->
                    <button id="send-button" class="bg-gradient-to-r from-emergency-blue-600 to-blue-500 text-white p-3 rounded-xl font-semibold hover:from-emergency-blue-700 hover:to-blue-600 transition-all duration-300 shadow-lg shadow-blue-500/40 hover:shadow-xl active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <!-- 引入自定义JavaScript -->
    <script src="js/main.js"></script>
</body>
</html>